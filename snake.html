<!DOCTYPE html>
<html>
    <div id="score">0</div>
    <canvas id="gameCanvas" width="300" height="300"></canvas>
    <script>
        let c = document.getElementById("gameCanvas");
        let ctx = c.getContext("2d");

        function clearCanvas(){
            ctx.fillStyle = "lightgreen";
            ctx.strokeStyle = "black";
            ctx.fillRect(0,0,gameCanvas.width,gameCanvas.height);
            ctx.strokeRect(0,0,gameCanvas.width,gameCanvas.height);
        }

        clearCanvas()

        let snake = [  {x: 150, y: 150},  {x: 140, y: 150},  {x: 130, y: 150},  {x: 120, y: 150},  {x: 110, y: 150}];
        let dx = 10;
        let dy = 0;
        let score = 0;

        function drawSnakePart(snakePart){
            ctx.fillStyle = "red";
            ctx.strokeStyle = "darkred";
            ctx.fillRect(snakePart.x,snakePart.y,10,10);
            ctx.strokeRect(snakePart.x,snakePart.y,10,10);
        }

        function changeDirection(event){
            const LEFT_KEY = 37;
            const RIGHT_KEY = 39;
            const UP_KEY = 38;
            const DOWN_KEY = 40;
            if (changingDirection) {return};
            changingDirection = true;
            const keyPressed = event.keyCode;
            const goingUp = dy === -10;
            const goingDown = dy ===10;
            const goingLeft = dx === -10;
            const goingRight = dx === 10;
            if (keyPressed === LEFT_KEY && !goingRight){ dx=-10 ; dy=0 };
            if (keyPressed === RIGHT_KEY && !goingLeft){ dx=10 ; dy=0 };
            if (keyPressed === UP_KEY && !goingDown){ dx=0 ; dy=-10 };
            if (keyPressed === DOWN_KEY && !goingUp){ dx=0 ; dy=10 };
        }

        function drawSnake(){
            snake.forEach(drawSnakePart);
        }
        

        function advanceSnake(){
            let head = {x: snake[0].x + dx, y:snake[0].y + dy};
            if (head.x < 0){head.x += gameCanvas.width};
            if (head.x >= gameCanvas.width){head.x -= gameCanvas.width};
            if (head.y < 0){head.y += gameCanvas.height};
            if (head.y >= gameCanvas.height){head.y -= gameCanvas.height}
            snake.unshift(head);
            const didEatFood = snake[0].x == foodX && snake[0].y == foodY;
            if (didEatFood){
                score += 10;
                document.getElementById('score').innerHTML = score;
                createFood();
            } else {
                snake.pop()
            };
        }

        function randomTen(min,max){
            return Math.round((Math.random()*(max-min) + min)/10)*10;
        }

        function createFood(){
            foodX = randomTen(0, gameCanvas.width - 10);
            foodY = randomTen(0, gameCanvas.height - 10);
            snake.forEach(
            function isFoodOnSnake(part){
                const foodIsOnSnake = part.x == foodX && part.y == foodY;
                if (foodIsOnSnake) createFood();
            }
        )
        }

        function drawFood(){
            ctx.fillStyle = "blue";
            ctx.strokeStyle = "dark blue";
            ctx.beginPath();
            ctx.arc(foodX + 5,foodY + 5,5,0,2*Math.PI);
            ctx.fill();
            ctx.stroke();
        }

        function didGameEnd(){
            for (let i = 4; i < snake.length; i++){
                const didCollide = snake[i].x == snake[0].x && snake[i].y == snake[0].y;
                if (didCollide){return true};
            }
            //const hitLeftWall = snake[0].x < 0;
            //const hitRightWall = snake[0].x > gameCanvas.width - 10;
            //const hitTopWall = snake[0].y < 0;
            //const hitBottomWall = snake[0].y > gameCanvas.height - 10;
            //return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall;
        }

        function main() {
            changingDirection = false;
            if (didGameEnd()){return}
            setTimeout(function onTick(){
            clearCanvas();
            drawFood();
            advanceSnake();
            drawSnake();
            main();
        },100)}

        createFood()
        main()
        document.addEventListener("keydown", changeDirection)
        

    </script>
</html>